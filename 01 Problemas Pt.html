<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1.0" />
    <title>Corriente El√©ctrica y Energ√≠a ‚Äì Actividad Interactiva</title>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800&family=JetBrains+Mono:wght@400;600&display=swap"
        rel="stylesheet" />
    <style>
        :root {
            --bg: #0f1117;
            --sur: #1a1d27;
            --sur2: #22263a;
            --acc: #6c63ff;
            --grn: #00d4aa;
            --gold: #ffd700;
            --txt: #e8eaf6;
            --mut: #8892b0;
            --brd: #2d3154;
            --ok: #00d4aa;
            --err: #ff6b6b;
            --wrn: #ffb347;
            --r: 14px;
            --sh: 0 8px 32px rgba(0, 0, 0, .4)
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: 'Inter', sans-serif;
            background: var(--bg);
            color: var(--txt);
            min-height: 100vh;
            padding-bottom: 80px
        }

        /* HEADER */
        header {
            background: linear-gradient(135deg, #1a1d27, #12152a);
            border-bottom: 1px solid var(--brd);
            padding: 22px 38px;
            display: flex;
            align-items: center;
            gap: 16px;
            position: sticky;
            top: 0;
            z-index: 100;
            backdrop-filter: blur(10px)
        }

        .hico {
            font-size: 2rem
        }

        header h1 {
            font-size: 1.35rem;
            font-weight: 800;
            background: linear-gradient(90deg, #6c63ff, #00d4aa);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text
        }

        header p {
            color: var(--mut);
            font-size: .8rem;
            margin-top: 2px
        }

        /* PROGRESS */
        .pbar-wrap {
            background: var(--sur);
            border-bottom: 1px solid var(--brd);
            padding: 10px 38px;
            display: flex;
            align-items: center;
            gap: 14px
        }

        .pbar-lbl {
            font-size: .76rem;
            color: var(--mut);
            white-space: nowrap
        }

        .pbar-track {
            flex: 1;
            height: 7px;
            background: var(--sur2);
            border-radius: 99px;
            overflow: hidden
        }

        .pbar-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--acc), var(--grn));
            border-radius: 99px;
            transition: width .5s ease;
            width: 0
        }

        .pbar-pct {
            font-size: .76rem;
            color: var(--grn);
            font-weight: 600;
            min-width: 32px;
            text-align: right
        }

        /* MAIN */
        main {
            max-width: 900px;
            margin: 0 auto;
            padding: 34px 18px
        }

        /* FORMULA BOX */
        .fbox {
            background: linear-gradient(135deg, #1e2140, #1a2035);
            border: 1px solid var(--acc);
            border-radius: var(--r);
            padding: 20px 24px;
            margin-bottom: 28px;
            box-shadow: 0 0 28px rgba(108, 99, 255, .14)
        }

        .fbox h2 {
            font-size: .92rem;
            font-weight: 700;
            color: var(--acc);
            margin-bottom: 12px;
            display: flex;
            align-items: center;
            gap: 7px
        }

        .fgrid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 9px
        }

        .fpill {
            background: var(--sur2);
            border: 1px solid var(--brd);
            border-radius: 9px;
            padding: 10px 14px;
            font-family: 'JetBrains Mono', monospace;
            font-size: .93rem;
            font-weight: 600;
            color: var(--grn);
            text-align: center
        }

        .fpill span {
            display: block;
            font-family: 'Inter', sans-serif;
            font-size: .68rem;
            color: var(--mut);
            font-weight: 400;
            margin-top: 3px
        }

        .fpill.gold {
            border-color: var(--gold);
            color: var(--gold)
        }

        .fnote {
            margin-top: 11px;
            font-size: .78rem;
            color: var(--mut);
            line-height: 1.55;
            background: rgba(108, 99, 255, .06);
            border-radius: 7px;
            padding: 9px 13px
        }

        .fnote code {
            color: var(--grn);
            font-family: 'JetBrains Mono', monospace;
            font-size: .84em
        }

        /* SI ALERT */
        .si-alert {
            background: rgba(255, 179, 71, .08);
            border: 1px solid rgba(255, 179, 71, .4);
            border-radius: 9px;
            padding: 11px 15px;
            margin-bottom: 26px;
            font-size: .83rem;
            line-height: 1.55;
            color: var(--wrn)
        }

        .si-alert strong {
            color: var(--txt)
        }

        /* SECTION TITLE */
        .sec-title {
            font-size: 1.2rem;
            font-weight: 800;
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 9px
        }

        .badge {
            background: linear-gradient(135deg, var(--acc), #9c94ff);
            color: #fff;
            font-size: .66rem;
            font-weight: 700;
            padding: 3px 9px;
            border-radius: 99px;
            letter-spacing: .05em
        }

        /* PROBLEM CARD */
        .pcard {
            background: var(--sur);
            border: 1px solid var(--brd);
            border-radius: var(--r);
            margin-bottom: 24px;
            overflow: hidden;
            box-shadow: var(--sh);
            transition: border-color .3s;
            animation: fadeUp .4s ease both
        }

        .pcard.solved {
            border-color: var(--ok)
        }

        .phead {
            background: linear-gradient(90deg, var(--sur2), var(--sur));
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid var(--brd)
        }

        .pnum {
            width: 36px;
            height: 36px;
            background: linear-gradient(135deg, var(--acc), #9c94ff);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 800;
            font-size: .92rem;
            flex-shrink: 0
        }

        .ptitle {
            font-weight: 700;
            font-size: .97rem
        }

        .psub {
            font-size: .76rem;
            color: var(--mut);
            margin-top: 2px
        }

        .pstatus {
            margin-left: auto;
            font-size: 1.25rem
        }

        .pbody {
            padding: 20px
        }

        /* DATA */
        .dsec {
            margin-bottom: 16px
        }

        .dsec h3 {
            font-size: .77rem;
            font-weight: 700;
            color: var(--mut);
            text-transform: uppercase;
            letter-spacing: .08em;
            margin-bottom: 9px
        }

        .dgrid {
            display: flex;
            flex-wrap: wrap;
            gap: 7px
        }

        .dchip {
            background: var(--sur2);
            border: 1px solid var(--brd);
            border-radius: 7px;
            padding: 6px 12px;
            font-size: .86rem;
            display: flex;
            align-items: center;
            gap: 6px
        }

        .dchip .sy {
            font-family: 'JetBrains Mono', monospace;
            font-weight: 700;
            color: var(--grn)
        }

        .dchip.warn {
            border-color: var(--wrn)
        }

        .dchip.warn .sy {
            color: var(--wrn)
        }

        /* UNIT CHECK */
        .ubox {
            background: rgba(255, 179, 71, .07);
            border: 1px solid rgba(255, 179, 71, .3);
            border-radius: 9px;
            padding: 12px 15px;
            margin-bottom: 14px
        }

        .ubox h4 {
            font-size: .76rem;
            font-weight: 700;
            color: var(--wrn);
            text-transform: uppercase;
            letter-spacing: .07em;
            margin-bottom: 9px;
            display: flex;
            align-items: center;
            gap: 5px
        }

        .uitem {
            display: flex;
            align-items: center;
            gap: 9px;
            margin-bottom: 7px;
            flex-wrap: wrap
        }

        .uitem .ml {
            font-weight: 600;
            min-width: 125px;
            font-size: .84rem
        }

        .uitem .gv {
            color: var(--mut);
            font-size: .81rem
        }

        .ubtn {
            background: var(--sur2);
            border: 2px solid var(--brd);
            border-radius: 5px;
            padding: 3px 10px;
            font-size: .74rem;
            font-weight: 600;
            cursor: pointer;
            color: var(--mut);
            transition: all .2s
        }

        .ubtn:hover {
            border-color: var(--wrn);
            color: var(--wrn)
        }

        .ubtn.done {
            border-color: var(--ok);
            background: rgba(0, 212, 170, .1);
            color: var(--ok);
            cursor: default
        }

        .chint {
            font-size: .74rem;
            color: var(--wrn);
            font-style: italic;
            display: none;
            margin-top: 2px;
            width: 100%
        }

        .chint.show {
            display: block
        }

        /* STEP */
        .step {
            background: var(--sur2);
            border: 1px solid var(--brd);
            border-radius: 9px;
            padding: 15px 17px;
            margin-bottom: 11px
        }

        .slbl {
            font-size: .75rem;
            font-weight: 700;
            color: var(--mut);
            text-transform: uppercase;
            letter-spacing: .07em;
            margin-bottom: 7px
        }

        .sq {
            font-size: .91rem;
            color: var(--txt);
            margin-bottom: 11px;
            line-height: 1.5
        }

        .fsel-lbl {
            font-size: .76rem;
            color: var(--mut);
            margin-bottom: 7px;
            font-weight: 500
        }

        /* BASE FORMULA BUTTONS ‚Äî only 3 */
        .fopts {
            display: flex;
            flex-wrap: wrap;
            gap: 9px;
            margin-bottom: 11px
        }

        .fbtn {
            background: var(--sur);
            border: 2px solid var(--brd);
            border-radius: 8px;
            padding: 10px 18px;
            font-family: 'JetBrains Mono', monospace;
            font-size: .92rem;
            font-weight: 600;
            color: var(--mut);
            cursor: pointer;
            transition: all .2s;
            white-space: nowrap
        }

        .fbtn:hover {
            border-color: var(--acc);
            color: var(--txt)
        }

        .fbtn.sel {
            border-color: var(--acc);
            background: rgba(108, 99, 255, .15);
            color: var(--acc)
        }

        .fbtn.correct {
            border-color: var(--ok);
            background: rgba(0, 212, 170, .15);
            color: var(--ok)
        }

        .fbtn.wrong {
            border-color: var(--err);
            background: rgba(255, 107, 107, .1);
            color: var(--err)
        }

        .fbtn:disabled {
            cursor: not-allowed;
            opacity: .6
        }

        /* BUTTON ROW */
        .brow {
            display: flex;
            align-items: center;
            gap: 9px;
            flex-wrap: wrap;
            margin-top: 4px
        }

        .cfmbtn {
            background: linear-gradient(135deg, var(--acc), #9c94ff);
            border: none;
            border-radius: 7px;
            padding: 7px 16px;
            color: #fff;
            font-family: 'Inter', sans-serif;
            font-size: .81rem;
            font-weight: 700;
            cursor: pointer;
            transition: all .2s
        }

        .cfmbtn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 14px rgba(108, 99, 255, .4)
        }

        .cfmbtn:disabled {
            opacity: .4;
            cursor: not-allowed;
            transform: none;
            box-shadow: none
        }

        .hintbtn {
            background: linear-gradient(135deg, #3a3d55, #4a4d65);
            border: none;
            border-radius: 7px;
            padding: 7px 14px;
            color: var(--mut);
            font-family: 'Inter', sans-serif;
            font-size: .81rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s
        }

        .hintbtn:hover {
            color: var(--txt)
        }

        .solbtn {
            background: linear-gradient(135deg, #1e3a2a, #1a3525);
            border: 1px solid rgba(0, 212, 170, .3);
            border-radius: 7px;
            padding: 7px 14px;
            color: var(--grn);
            font-family: 'Inter', sans-serif;
            font-size: .81rem;
            font-weight: 600;
            cursor: pointer;
            transition: all .2s
        }

        .solbtn:hover {
            border-color: var(--grn);
            background: rgba(0, 212, 170, .12)
        }

        /* FEEDBACK */
        .fb {
            border-radius: 7px;
            padding: 10px 13px;
            font-size: .84rem;
            display: none;
            align-items: flex-start;
            gap: 8px;
            line-height: 1.5;
            margin-top: 7px
        }

        .fb.show {
            display: flex
        }

        .fb.ok {
            background: rgba(0, 212, 170, .1);
            border: 1px solid var(--ok);
            color: var(--ok)
        }

        .fb.er {
            background: rgba(255, 107, 107, .1);
            border: 1px solid var(--err);
            color: var(--err)
        }

        .fb.hi {
            background: rgba(255, 179, 71, .08);
            border: 1px solid var(--wrn);
            color: var(--wrn)
        }

        .fb.so {
            background: rgba(0, 212, 170, .06);
            border: 1px solid rgba(0, 212, 170, .4);
            color: var(--grn)
        }

        .fb .ico {
            font-size: .95rem;
            flex-shrink: 0;
            margin-top: 1px
        }

        .fb strong {
            display: block;
            margin-bottom: 2px
        }

        /* EXAMPLE */
        .excard {
            background: linear-gradient(135deg, #1a2035, #1e2545);
            border: 2px solid var(--gold);
            border-radius: var(--r);
            margin-bottom: 32px;
            overflow: hidden;
            animation: pgold 3s ease-in-out infinite
        }

        .exhead {
            background: linear-gradient(90deg, rgba(255, 215, 0, .15), transparent);
            padding: 15px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(255, 215, 0, .3)
        }

        .exbadge {
            background: var(--gold);
            color: #1a1d27;
            font-size: .66rem;
            font-weight: 800;
            padding: 3px 9px;
            border-radius: 99px;
            letter-spacing: .05em;
            margin-left: auto
        }

        .exbody {
            padding: 20px
        }

        .exstep {
            background: rgba(255, 255, 255, .04);
            border: 1px solid rgba(255, 215, 0, .2);
            border-radius: 9px;
            padding: 15px 17px;
            margin-bottom: 11px
        }

        .exlbl {
            font-size: .7rem;
            font-weight: 700;
            color: var(--gold);
            text-transform: uppercase;
            letter-spacing: .08em;
            margin-bottom: 6px
        }

        .exstep p {
            font-size: .86rem;
            line-height: 1.6;
            color: var(--txt)
        }

        .exstep p+p {
            margin-top: 5px
        }

        .fml {
            font-family: 'JetBrains Mono', monospace;
            font-size: .92rem;
            font-weight: 700;
            color: var(--grn);
            background: var(--sur2);
            border-radius: 5px;
            padding: 6px 12px;
            display: inline-block;
            margin: 6px 0
        }

        .res {
            font-family: 'JetBrains Mono', monospace;
            font-size: .92rem;
            font-weight: 700;
            color: var(--gold);
            background: rgba(255, 215, 0, .08);
            border-radius: 5px;
            padding: 6px 12px;
            display: inline-block;
            margin: 3px 0
        }

        .exnote {
            font-size: .76rem;
            color: var(--mut);
            margin-top: 5px;
            font-style: italic
        }

        /* SCORE */
        .score {
            position: fixed;
            bottom: 16px;
            right: 16px;
            background: var(--sur);
            border: 1px solid var(--acc);
            border-radius: 11px;
            padding: 10px 16px;
            display: flex;
            align-items: center;
            gap: 9px;
            box-shadow: var(--sh);
            z-index: 200
        }

        .slbl2 {
            font-size: .7rem;
            color: var(--mut)
        }

        .sval {
            font-size: 1.3rem;
            font-weight: 800;
            color: var(--grn)
        }

        /* CELEBRATION */
        .cel {
            text-align: center;
            padding: 38px 18px;
            display: none
        }

        .cel.show {
            display: block
        }

        .cel .emo {
            font-size: 3.6rem;
            margin-bottom: 13px
        }

        .cel h2 {
            font-size: 1.65rem;
            font-weight: 800;
            color: var(--gold);
            margin-bottom: 7px
        }

        .cel p {
            color: var(--mut);
            font-size: .92rem
        }

        /* ANIMATIONS */
        @keyframes fadeUp {
            from {
                opacity: 0;
                transform: translateY(13px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        @keyframes pgold {

            0%,
            100% {
                box-shadow: 0 0 18px rgba(255, 215, 0, .1)
            }

            50% {
                box-shadow: 0 0 38px rgba(255, 215, 0, .27)
            }
        }

        @keyframes pop {
            from {
                transform: scale(0)
            }

            to {
                transform: scale(1)
            }
        }

        .pop {
            display: inline-block;
            animation: pop .3s cubic-bezier(.175, .885, .32, 1.275)
        }

        @media(max-width:600px) {
            header {
                padding: 14px 12px
            }

            header h1 {
                font-size: 1rem
            }

            main {
                padding: 16px 9px
            }

            .fgrid {
                grid-template-columns: 1fr 1fr
            }
        }
    </style>
</head>

<body>

    <header>
        <div class="hico">‚ö°</div>
        <div>
            <h1>Corriente El√©ctrica y Energ√≠a</h1>
            <p style="color:var(--grn);font-weight:600;font-size:.85rem;margin-top:1px">Narciso Valle Campos</p>
            <p>Actividad interactiva ¬∑ Elige la f√≥rmula base y despeja en tu cuaderno</p>
        </div>
    </header>

    <div class="pbar-wrap">
        <span class="pbar-lbl">Progreso</span>
        <div class="pbar-track">
            <div class="pbar-fill" id="pFill"></div>
        </div>
        <span class="pbar-pct" id="pPct">0%</span>
    </div>

    <main>

        <!-- F√ìRMULAS BASE -->
        <div class="fbox">
            <h2>üìê F√≥rmulas base ‚Äî todo se desprende de estas tres</h2>
            <div class="fgrid">
                <div class="fpill">E = P ¬∑ t <span>Energ√≠a (J) = Potencia (W) √ó Tiempo (s)</span></div>
                <div class="fpill">P = R ¬∑ I¬≤ <span>Potencia (W) = Resistencia (Œ©) √ó Intensidad¬≤ (A¬≤)</span></div>
                <div class="fpill">I = V / R <span>Intensidad (A) = Voltaje (V) / Resistencia (Œ©)</span></div>
                <div class="fpill gold">Coste = E<sub>kWh</sub> ¬∑ Precio <span>Coste (‚Ç¨) = Energ√≠a (kWh) √ó Precio
                        (‚Ç¨/kWh)</span></div>
            </div>
            <div class="fnote">
                üí° <strong style="color:var(--txt)">Recuerda:</strong> para calcular cualquier magnitud deber√°s <strong
                    style="color:var(--grn)">despejar</strong> la inc√≥gnita de una de estas f√≥rmulas en tu cuaderno. Por
                ejemplo, de <code>P = R ¬∑ I¬≤</code> puedes despejar <code>R = P / I¬≤</code> o <code>I = ‚àö(P/R)</code>; y
                de <code>I = V / R</code> puedes despejar <code>V = I ¬∑ R</code>.
            </div>
        </div>

        <!-- AVISO SI -->
        <div class="si-alert">
            ‚öñÔ∏è <strong>Unidades del Sistema Internacional (SI) obligatorias:</strong>
            Potencia en <strong>W</strong>, Resistencia en <strong>Œ©</strong>, Intensidad en <strong>A</strong>, Voltaje
            en <strong>V</strong>,
            y <strong>Tiempo siempre en segundos (s)</strong>.
            La energ√≠a se obtiene en <strong>Julios (J)</strong> con <em>E = P ¬∑ t</em>.
            Para obtener kWh: <strong>E(kWh) = E(J) √∑ 3 600 000</strong>.
        </div>

        <!-- EJEMPLO PROBLEMA 1 -->
        <div class="sec-title">
            <span>üìñ Ejemplo guiado</span>
            <span class="badge">PROBLEMA 1 ¬∑ RESUELTO</span>
        </div>

        <div class="excard">
            <div class="exhead">
                <div class="pnum" style="background:linear-gradient(135deg,#ffd700,#ffb347);color:#1a1d27">1</div>
                <div>
                    <div class="ptitle">Plancha de ropa</div>
                    <div class="psub">Sigue este ejemplo y replica los pasos en tu cuaderno</div>
                </div>
                <span class="exbadge">EJEMPLO</span>
            </div>
            <div class="exbody">

                <div class="exstep">
                    <div class="exlbl">üìã Paso 1 ¬∑ Datos</div>
                    <div style="margin-top:8px;display:flex;flex-wrap:wrap;gap:8px">
                        <div class="dchip"><span class="sy">P</span><span>= 920 W</span></div>
                        <div class="dchip warn"><span class="sy">t</span><span>= 3 horas</span></div>
                        <div class="dchip"><span class="sy">I</span><span>= 4 A</span></div>
                    </div>
                </div>

                <div class="exstep">
                    <div class="exlbl">‚öñÔ∏è Paso 2 ¬∑ Conversi√≥n a unidades SI</div>
                    <div style="margin-top:8px;display:flex;flex-direction:column;gap:7px;font-size:.85rem">
                        <div style="display:flex;align-items:center;gap:9px"><span
                                style="font-weight:600;min-width:120px">Potencia (P)</span><span
                                style="color:var(--mut)">920 W</span><span style="color:var(--ok)">‚úÖ Vatios ‚Äî
                                correcto</span></div>
                        <div style="display:flex;align-items:center;gap:9px;flex-wrap:wrap"><span
                                style="font-weight:600;min-width:120px">Tiempo (t)</span><span
                                style="color:var(--mut)">3 horas</span><span style="color:var(--wrn)">‚ö†Ô∏è Convertir a
                                segundos</span><span style="color:var(--wrn);font-size:.78rem;font-style:italic">‚Üí 3 √ó
                                3600 = <strong style="color:var(--gold)">10 800 s</strong></span></div>
                        <div style="display:flex;align-items:center;gap:9px"><span
                                style="font-weight:600;min-width:120px">Intensidad (I)</span><span
                                style="color:var(--mut)">4 A</span><span style="color:var(--ok)">‚úÖ Amperios ‚Äî
                                correcto</span></div>
                    </div>
                    <p class="exnote" style="margin-top:8px">üìå A partir de ahora usamos <strong
                            style="color:var(--gold)">t = 10 800 s</strong></p>
                </div>

                <div class="exstep">
                    <div class="exlbl">üî¢ Paso 3 ¬∑ Apartado a) Energ√≠a y Coste</div>
                    <p><strong>¬øQu√© nos piden?</strong> E en Julios y kWh, y el coste.</p>
                    <p><strong>¬øQu√© datos tenemos?</strong> P = 920 W y t = 10 800 s.</p>
                    <p><strong>F√≥rmula base elegida:</strong> <code style="color:var(--grn)">E = P ¬∑ t</code> ‚Äî ya est√°
                        despejada para E.</p>
                    <div class="fml">E = P ¬∑ t</div>
                    <p><strong>Despeje y sustituci√≥n:</strong></p>
                    <div class="res">E = 920 √ó 10 800 = 9 936 000 J</div>
                    <div class="res" style="margin-top:4px">E(kWh) = 9 936 000 √∑ 3 600 000 = 2.76 kWh</div>
                    <div class="res" style="margin-top:4px">Coste = 2.76 √ó 0.18 = 0.4968 ‚Ç¨</div>
                </div>

                <div class="exstep">
                    <div class="exlbl">üî¢ Paso 4 ¬∑ Apartado b) Resistencia</div>
                    <p><strong>¬øQu√© nos piden?</strong> R.</p>
                    <p><strong>¬øQu√© datos tenemos?</strong> P = 920 W e I = 4 A.</p>
                    <p><strong>F√≥rmula base elegida:</strong> <code style="color:var(--grn)">P = R ¬∑ I¬≤</code> ‚Äî
                        despejamos R en el cuaderno.</p>
                    <div class="fml">P = R ¬∑ I¬≤ ‚Üí R = P / I¬≤</div>
                    <div class="res">R = 920 / 4¬≤ = 920 / 16 = 57.5 Œ©</div>
                </div>

                <div class="exstep">
                    <div class="exlbl">üî¢ Paso 5 ¬∑ Apartado c) Voltaje</div>
                    <p><strong>¬øQu√© nos piden?</strong> V.</p>
                    <p><strong>¬øQu√© datos tenemos?</strong> I = 4 A y R = 57.5 Œ© (calculada).</p>
                    <p><strong>F√≥rmula base elegida:</strong> <code style="color:var(--grn)">I = V / R</code> ‚Äî
                        despejamos V en el cuaderno.</p>
                    <div class="fml">I = V / R ‚Üí V = I ¬∑ R</div>
                    <div class="res">V = 4 √ó 57.5 = 230 V</div>
                </div>

                <div
                    style="background:rgba(0,212,170,.1);border:1px solid var(--ok);border-radius:9px;padding:12px 15px;margin-top:2px">
                    <p style="color:var(--ok);font-weight:700;margin-bottom:4px">‚úÖ ¬°Problema 1 completado!</p>
                    <p style="font-size:.83rem;color:var(--mut)">Copia este proceso en tu cuaderno. Recuerda siempre:
                        <strong style="color:var(--txt)">1) Datos ‚Üí 2) Convertir a SI ‚Üí 3) Elegir f√≥rmula base ‚Üí 4)
                            Despejar en el cuaderno ‚Üí 5) Sustituir ‚Üí 6) Resultado</strong>
                    </p>
                </div>

            </div>
        </div>

        <!-- PROBLEMAS INTERACTIVOS -->
        <div class="sec-title" style="margin-top:2px">
            <span>üéØ Ahora t√∫</span>
            <span class="badge">PROBLEMAS 2‚Äì6 ¬∑ INTERACTIVOS</span>
        </div>

        <div id="pcont"></div>

        <div class="cel" id="cel">
            <div class="emo">üèÜ</div>
            <h2>¬°Actividad completada!</h2>
            <p>Has seleccionado correctamente todas las f√≥rmulas base. ¬°Excelente trabajo!</p>
            <p style="margin-top:7px;color:var(--grn);font-weight:600">Compara tus c√°lculos del cuaderno con las
                soluciones que has desbloqueado.</p>
        </div>

    </main>

    <div class="score">
        <div>
            <div class="slbl2">Respuestas correctas</div>
            <div class="sval" id="sval">0 / 15</div>
        </div>
        <span style="font-size:1.45rem">‚≠ê</span>
    </div>

    <script>
        // ‚îÄ‚îÄ‚îÄ PROBLEMS DATA ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        // correct: which base formula to pick
        // hint: shown when wrong answer or hint button pressed
        // solution: shown when solution button pressed (numerical result)
        const problems = [
            {
                id: 2, device: "Secador de pelo", dataLabel: "(P, t, I)",
                data: [
                    { sy: "P", val: "1150 W", ok: true, note: null },
                    { sy: "t", val: "30 minutos", ok: false, note: "‚ö†Ô∏è 30 min √ó 60 = 1800 s" },
                    { sy: "I", val: "5 A", ok: true, note: null }
                ],
                parts: [
                    {
                        label: "a) Energ√≠a (E) y Coste",
                        q: "Calcula la energ√≠a en Julios y en kWh. Calcula tambi√©n el coste (precio: 0.25 ‚Ç¨/kWh). Usa t = 1800 s.",
                        correct: "E = P ¬∑ t",
                        hint: "Tienes P y t. ¬øCu√°l de las tres f√≥rmulas base relaciona la energ√≠a con la potencia y el tiempo?",
                        wrongHint: {
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula relaciona potencia, resistencia e intensidad ‚Äî no aparece la energ√≠a. Busca la que s√≠ incluya E.",
                            "I = V / R": "Esa f√≥rmula relaciona intensidad, voltaje y resistencia ‚Äî no aparece la energ√≠a. Busca la que s√≠ incluya E."
                        },
                        solution: "E = 1150 √ó 1800 = 2 070 000 J ‚Üí E(kWh) = 2 070 000 √∑ 3 600 000 = 0.575 kWh ‚Üí Coste = 0.575 √ó 0.25 = 0.14375 ‚Ç¨"
                    },
                    {
                        label: "b) Resistencia (R)",
                        q: "Calcula la resistencia del secador. Despeja R en tu cuaderno.",
                        correct: "P = R ¬∑ I¬≤",
                        hint: "Tienes P e I. ¬øCu√°l de las tres f√≥rmulas base contiene P, R e I¬≤?",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula relaciona energ√≠a, potencia y tiempo ‚Äî no aparece la resistencia. Busca la que contenga R.",
                            "I = V / R": "Esa f√≥rmula relaciona I, V y R, pero no incluye la potencia P que nos dan. Busca la que contenga P y R."
                        },
                        solution: "Despeje: P = R¬∑I¬≤ ‚Üí R = P/I¬≤ = 1150 / 5¬≤ = 1150 / 25 = 46 Œ©"
                    },
                    {
                        label: "c) Voltaje (V)",
                        q: "Calcula el voltaje al que est√° conectado el secador. Despeja V en tu cuaderno.",
                        correct: "I = V / R",
                        hint: "Tienes I y R (calculada). ¬øCu√°l de las tres f√≥rmulas base relaciona I, V y R?",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula relaciona energ√≠a, potencia y tiempo ‚Äî no aparece el voltaje. Busca la que contenga V.",
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene el voltaje V. Busca la que relacione I, V y R."
                        },
                        solution: "Despeje: I = V/R ‚Üí V = I¬∑R = 5 √ó 46 = 230 V"
                    }
                ]
            },
            {
                id: 3, device: "Horno microondas", dataLabel: "(P, t, R)",
                data: [
                    { sy: "P", val: "1150 W", ok: true, note: null },
                    { sy: "t", val: "10 horas", ok: false, note: "‚ö†Ô∏è 10 h √ó 3600 = 36 000 s" },
                    { sy: "R", val: "46 Œ©", ok: true, note: null }
                ],
                parts: [
                    {
                        label: "a) Energ√≠a (E) y Coste",
                        q: "Calcula la energ√≠a en Julios y en kWh. Calcula tambi√©n el coste (precio: 0.25 ‚Ç¨/kWh). Usa t = 36 000 s.",
                        correct: "E = P ¬∑ t",
                        hint: "Tienes P y t. ¬øCu√°l de las tres f√≥rmulas base relaciona la energ√≠a con la potencia y el tiempo?",
                        wrongHint: {
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E.",
                            "I = V / R": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E."
                        },
                        solution: "E = 41 400 000 J ‚Üí 11.5 kWh ‚Üí Coste = 2.875 ‚Ç¨"
                    },
                    {
                        label: "b) Intensidad (I)",
                        q: "Calcula la intensidad que circula por el microondas. Despeja I en tu cuaderno.",
                        correct: "P = R ¬∑ I¬≤",
                        hint: "Tienes P y R. ¬øCu√°l de las tres f√≥rmulas base contiene P, R e I¬≤? Deber√°s despejar I.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la intensidad I. Busca la que contenga P, R e I.",
                            "I = V / R": "Esa f√≥rmula contiene I pero no la potencia P que nos dan. Busca la que relacione P, R e I."
                        },
                        solution: "I = 5 A"
                    },
                    {
                        label: "c) Voltaje (V)",
                        q: "Calcula el voltaje al que est√° conectado el microondas. Despeja V en tu cuaderno.",
                        correct: "I = V / R",
                        hint: "Tienes I (calculada) y R. ¬øCu√°l de las tres f√≥rmulas base relaciona I, V y R?",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene el voltaje V. Busca la que relacione I, V y R.",
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene el voltaje V. Busca la que relacione I, V y R."
                        },
                        solution: "V = 230 V"
                    }
                ]
            },
            {
                id: 4, device: "Lavavajillas", dataLabel: "(P, t, R)",
                data: [
                    { sy: "P", val: "1840 W", ok: true, note: null },
                    { sy: "t", val: "2 horas", ok: false, note: "‚ö†Ô∏è 2 h √ó 3600 = 7200 s" },
                    { sy: "R", val: "28.75 Œ©", ok: true, note: null }
                ],
                parts: [
                    {
                        label: "a) Energ√≠a (E) y Coste",
                        q: "Calcula la energ√≠a en Julios y en kWh. Calcula tambi√©n el coste (precio: 0.25 ‚Ç¨/kWh). Usa t = 7200 s.",
                        correct: "E = P ¬∑ t",
                        hint: "Tienes P y t. ¬øCu√°l de las tres f√≥rmulas base relaciona la energ√≠a con la potencia y el tiempo?",
                        wrongHint: {
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E.",
                            "I = V / R": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E."
                        },
                        solution: "E = 13 248 000 J ‚Üí 3.68 kWh ‚Üí Coste = 0.92 ‚Ç¨"
                    },
                    {
                        label: "b) Intensidad (I)",
                        q: "Calcula la intensidad que circula por el lavavajillas. Despeja I en tu cuaderno.",
                        correct: "P = R ¬∑ I¬≤",
                        hint: "Tienes P y R. ¬øCu√°l de las tres f√≥rmulas base contiene P, R e I¬≤? Deber√°s despejar I.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la intensidad I. Busca la que contenga P, R e I.",
                            "I = V / R": "Esa f√≥rmula contiene I pero no la potencia P que nos dan. Busca la que relacione P, R e I."
                        },
                        solution: "I = 8 A"
                    },
                    {
                        label: "c) Voltaje (V)",
                        q: "Calcula el voltaje al que est√° conectado el lavavajillas. Despeja V en tu cuaderno.",
                        correct: "I = V / R",
                        hint: "Tienes I (calculada) y R. ¬øCu√°l de las tres f√≥rmulas base relaciona I, V y R?",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene el voltaje V. Busca la que relacione I, V y R.",
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene el voltaje V. Busca la que relacione I, V y R."
                        },
                        solution: "V = 230 V"
                    }
                ]
            },
            {
                id: 5, device: "Tostadora", dataLabel: "(P, t, V)",
                data: [
                    { sy: "P", val: "1150 W", ok: true, note: null },
                    { sy: "t", val: "90 minutos", ok: false, note: "‚ö†Ô∏è 90 min √ó 60 = 5400 s" },
                    { sy: "V", val: "230 V", ok: true, note: null }
                ],
                parts: [
                    {
                        label: "a) Energ√≠a (E) y Coste",
                        q: "Calcula la energ√≠a en Julios y en kWh. Calcula tambi√©n el coste (precio: 0.20 ‚Ç¨/kWh). Usa t = 5400 s.",
                        correct: "E = P ¬∑ t",
                        hint: "Tienes P y t. ¬øCu√°l de las tres f√≥rmulas base relaciona la energ√≠a con la potencia y el tiempo?",
                        wrongHint: {
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E.",
                            "I = V / R": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E."
                        },
                        solution: "E = 6 210 000 J ‚Üí 1.725 kWh ‚Üí Coste = 0.345 ‚Ç¨"
                    },
                    {
                        label: "b) Resistencia (R)",
                        q: "Calcula la resistencia de la tostadora. Pista: necesitar√°s combinar dos f√≥rmulas base. Despeja en tu cuaderno.",
                        correct: "P = R ¬∑ I¬≤",
                        hint: "Tienes P y V (pero no I). Sustituye I = V/R de la tercera f√≥rmula en P = R¬∑I¬≤ y despeja R. La f√≥rmula base de partida es P = R¬∑I¬≤.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la resistencia R. Piensa en cu√°l de las otras dos f√≥rmulas aparece R junto con P.",
                            "I = V / R": "Es una buena idea usarla como sustituci√≥n, pero la f√≥rmula BASE de partida que contiene P y R es otra."
                        },
                        solution: "R = 46 Œ©"
                    },
                    {
                        label: "c) Intensidad (I)",
                        q: "Calcula la intensidad que circula por la tostadora. Despeja I en tu cuaderno.",
                        correct: "I = V / R",
                        hint: "Tienes V y R (calculada). ¬øCu√°l de las tres f√≥rmulas base relaciona I, V y R? Ya est√° despejada para I.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la intensidad I ni el voltaje V. Busca la que relacione I, V y R.",
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula contiene I y R, pero no el voltaje V que nos dan. Busca la que relacione I, V y R directamente."
                        },
                        solution: "I = V/R = 230 / 46 = 5 A"
                    }
                ]
            },
            {
                id: 6, device: "Nevera", dataLabel: "(P, t, V)",
                data: [
                    { sy: "P", val: "230 W", ok: true, note: null },
                    { sy: "t", val: "24 horas", ok: false, note: "‚ö†Ô∏è 24 h √ó 3600 = 86 400 s" },
                    { sy: "V", val: "230 V", ok: true, note: null }
                ],
                parts: [
                    {
                        label: "a) Energ√≠a (E) y Coste",
                        q: "Calcula la energ√≠a en Julios y en kWh. Calcula tambi√©n el coste (precio: 0.20 ‚Ç¨/kWh). Usa t = 86 400 s.",
                        correct: "E = P ¬∑ t",
                        hint: "Tienes P y t. ¬øCu√°l de las tres f√≥rmulas base relaciona la energ√≠a con la potencia y el tiempo?",
                        wrongHint: {
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E.",
                            "I = V / R": "Esa f√≥rmula no contiene la energ√≠a E. Busca la que s√≠ incluya E."
                        },
                        solution: "E = 19 872 000 J ‚Üí 5.52 kWh ‚Üí Coste = 1.104 ‚Ç¨"
                    },
                    {
                        label: "b) Resistencia (R)",
                        q: "Calcula la resistencia de la nevera. Pista: necesitar√°s combinar dos f√≥rmulas base. Despeja en tu cuaderno.",
                        correct: "P = R ¬∑ I¬≤",
                        hint: "Tienes P y V (pero no I). Sustituye I = V/R de la tercera f√≥rmula en P = R¬∑I¬≤ y despeja R. La f√≥rmula base de partida es P = R¬∑I¬≤.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la resistencia R. Piensa en cu√°l de las otras dos f√≥rmulas aparece R junto con P.",
                            "I = V / R": "Es una buena idea usarla como sustituci√≥n, pero la f√≥rmula BASE de partida que contiene P y R es otra."
                        },
                        solution: "R = 230 Œ©"
                    },
                    {
                        label: "c) Intensidad (I)",
                        q: "Calcula la intensidad que circula por la nevera. Despeja I en tu cuaderno.",
                        correct: "I = V / R",
                        hint: "Tienes V y R (calculada). ¬øCu√°l de las tres f√≥rmulas base relaciona I, V y R? Ya est√° despejada para I.",
                        wrongHint: {
                            "E = P ¬∑ t": "Esa f√≥rmula no contiene la intensidad I ni el voltaje V. Busca la que relacione I, V y R.",
                            "P = R ¬∑ I¬≤": "Esa f√≥rmula contiene I y R, pero no el voltaje V que nos dan. Busca la que relacione I, V y R directamente."
                        },
                        solution: "I = V/R = 230 / 230 = 1 A"
                    }
                ]
            }
        ];

        const BASE_FORMULAS = ["E = P ¬∑ t", "P = R ¬∑ I¬≤", "I = V / R"];

        // ‚îÄ‚îÄ‚îÄ STATE ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        let totalCorrect = 0;
        const totalQ = problems.reduce((s, p) => s + p.parts.length, 0);
        const st = {}; // { probId: { partIdx: { sel, confirmed, correct } } }

        // ‚îÄ‚îÄ‚îÄ RENDER ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function renderAll() {
            const cont = document.getElementById('pcont');
            problems.forEach((prob, pi) => {
                st[prob.id] = {};
                prob.parts.forEach((_, i) => { st[prob.id][i] = { sel: null, confirmed: false, correct: false }; });

                const card = document.createElement('div');
                card.className = 'pcard';
                card.id = `pc-${prob.id}`;
                card.style.animationDelay = `${pi * 0.07}s`;
                card.innerHTML = `
      <div class="phead">
        <div class="pnum">${prob.id}</div>
        <div><div class="ptitle">${prob.device}</div><div class="psub">Datos: ${prob.dataLabel}</div></div>
        <span class="pstatus" id="ps-${prob.id}">‚è≥</span>
      </div>
      <div class="pbody">
        ${renderData(prob)}
        ${renderUnits(prob)}
        ${prob.parts.map((p, i) => renderPart(prob, p, i)).join('')}
      </div>`;
                cont.appendChild(card);
            });
        }

        function renderData(prob) {
            return `<div class="dsec"><h3>üìã Datos del problema</h3><div class="dgrid">
    ${prob.data.map(d => `<div class="dchip ${d.ok ? '' : 'warn'}"><span class="sy">${d.sy}</span><span>= ${d.val}</span></div>`).join('')}
  </div></div>`;
        }

        function renderUnits(prob) {
            const items = prob.data.map((d, i) => `
    <div class="uitem">
      <span class="ml">${d.sy} = ${d.val}</span>
      <span class="gv">${d.ok ? '‚úÖ Unidad SI correcta' : '‚ö†Ô∏è Convertir'}</span>
      ${!d.ok ? `<button class="ubtn" id="ub-${prob.id}-${i}" onclick="showConv(${prob.id},${i})">Ver conversi√≥n</button>
        <span class="chint" id="ch-${prob.id}-${i}">${d.note}</span>` : ''}
    </div>`).join('');
            return `<div class="ubox"><h4>‚öñÔ∏è Comprobaci√≥n de unidades SI</h4>${items}</div>`;
        }

        function renderPart(prob, part, idx) {
            const btns = BASE_FORMULAS.map(f => {
                const sid = f.replace(/[^a-zA-Z0-9]/g, '_');
                return `<button class="fbtn" id="fb-${prob.id}-${idx}-${sid}"
      onclick="selF(${prob.id},${idx},'${f.replace(/'/g, "\\'")}')">
      ${f}
    </button>`;
            }).join('');

            return `<div class="step" id="st-${prob.id}-${idx}">
    <div class="slbl">${part.label}</div>
    <div class="sq">${part.q}</div>
    <div class="fsel-lbl">üîç Selecciona la f√≥rmula base correcta:</div>
    <div class="fopts">${btns}</div>
    <div class="brow">
      <button class="cfmbtn" id="cfm-${prob.id}-${idx}" onclick="confirmF(${prob.id},${idx})" disabled>Confirmar</button>
      <button class="hintbtn" onclick="showHint(${prob.id},${idx})">üí° Pista</button>
      <button class="solbtn" onclick="showSol(${prob.id},${idx})">üìã Soluci√≥n</button>
    </div>
    <div class="fb" id="fbd-${prob.id}-${idx}"></div>
  </div>`;
        }

        // ‚îÄ‚îÄ‚îÄ INTERACTIONS ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
        function showConv(pid, di) {
            document.getElementById(`ch-${pid}-${di}`).classList.add('show');
            const b = document.getElementById(`ub-${pid}-${di}`);
            b.textContent = '‚úÖ Entendido'; b.classList.add('done'); b.disabled = true;
        }

        function selF(pid, idx, formula) {
            if (st[pid][idx].confirmed) return;
            BASE_FORMULAS.forEach(f => {
                const b = document.getElementById(`fb-${pid}-${idx}-${f.replace(/[^a-zA-Z0-9]/g, '_')}`);
                if (b) b.classList.remove('sel');
            });
            const b = document.getElementById(`fb-${pid}-${idx}-${formula.replace(/[^a-zA-Z0-9]/g, '_')}`);
            if (b) b.classList.add('sel');
            st[pid][idx].sel = formula;
            const cfm = document.getElementById(`cfm-${pid}-${idx}`);
            if (cfm) cfm.disabled = false;
        }

        function confirmF(pid, idx) {
            const s = st[pid][idx];
            if (!s.sel || s.confirmed) return;
            const prob = problems.find(p => p.id === pid);
            const part = prob.parts[idx];
            const ok = s.sel === part.correct;
            s.confirmed = true; s.correct = ok;

            BASE_FORMULAS.forEach(f => {
                const b = document.getElementById(`fb-${pid}-${idx}-${f.replace(/[^a-zA-Z0-9]/g, '_')}`);
                if (b) { b.disabled = true; b.classList.remove('sel'); }
            });
            const selB = document.getElementById(`fb-${pid}-${idx}-${s.sel.replace(/[^a-zA-Z0-9]/g, '_')}`);
            if (selB) selB.classList.add(ok ? 'correct' : 'wrong');
            if (!ok) {
                const cB = document.getElementById(`fb-${pid}-${idx}-${part.correct.replace(/[^a-zA-Z0-9]/g, '_')}`);
                if (cB) cB.classList.add('correct');
            }
            document.getElementById(`cfm-${pid}-${idx}`).disabled = true;

            const fbd = document.getElementById(`fbd-${pid}-${idx}`);
            if (ok) {
                fbd.className = 'fb show ok';
                fbd.innerHTML = `<span class="ico pop">‚úÖ</span><div><strong>¬°Correcto!</strong>Has elegido la f√≥rmula base correcta. Ahora despeja la magnitud pedida en tu cuaderno y calcula el resultado.</div>`;
                totalCorrect++;
            } else {
                const wh = part.wrongHint[s.sel] || "Esa no es la f√≥rmula base correcta.";
                fbd.className = 'fb show er';
                fbd.innerHTML = `<span class="ico">‚ùå</span><div><strong>No es la correcta.</strong>${wh} La f√≥rmula correcta es <strong>${part.correct}</strong>.</div>`;
            }
            updateScore();
            checkDone(pid);
        }

        function showHint(pid, idx) {
            const s = st[pid][idx];
            if (s.confirmed) return;
            const part = problems.find(p => p.id === pid).parts[idx];
            const fbd = document.getElementById(`fbd-${pid}-${idx}`);
            fbd.className = 'fb show hi';
            fbd.innerHTML = `<span class="ico">üí°</span><div><strong>Pista:</strong> ${part.hint}</div>`;
        }

        function showSol(pid, idx) {
            const part = problems.find(p => p.id === pid).parts[idx];
            const fbd = document.getElementById(`fbd-${pid}-${idx}`);
            // Keep existing feedback if confirmed, append solution below
            const existing = fbd.classList.contains('show') && !fbd.classList.contains('so') ? fbd.innerHTML : '';
            fbd.className = 'fb show so';
            fbd.innerHTML = (existing ? `<div style="width:100%;margin-bottom:8px;padding-bottom:8px;border-bottom:1px solid rgba(0,212,170,.2)">${existing}</div>` : '')
                + `<span class="ico">üìã</span><div><strong>Soluci√≥n:</strong> ${part.solution}</div>`;
        }

        function checkDone(pid) {
            const ps = st[pid];
            const allDone = Object.values(ps).every(s => s.confirmed);
            const allOk = Object.values(ps).every(s => s.correct);
            if (allDone) {
                document.getElementById(`pc-${pid}`).classList.add('solved');
                document.getElementById(`ps-${pid}`).innerHTML = `<span class="pop">${allOk ? '‚úÖ' : '‚ö†Ô∏è'}</span>`;
            }
            if (problems.every(p => Object.values(st[p.id]).every(s => s.confirmed))) {
                setTimeout(() => {
                    const c = document.getElementById('cel');
                    c.classList.add('show');
                    c.scrollIntoView({ behavior: 'smooth' });
                }, 600);
            }
        }

        function updateScore() {
            document.getElementById('sval').textContent = `${totalCorrect} / ${totalQ}`;
            const pct = Math.round(totalCorrect / totalQ * 100);
            document.getElementById('pFill').style.width = pct + '%';
            document.getElementById('pPct').textContent = pct + '%';
        }

        renderAll();
    </script>
</body>

</html>